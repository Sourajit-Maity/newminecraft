{% extends "../layouts/body.html"%}
{% block navbar %}
	{% include "../layouts/navbar.html" with category="Home" %}
{% endblock %}

{% block header %}
	<style>
	</style>
{% endblock %}

{% block toolbar %}
    <div class="row mb-2">
        <div class="col-sm-6">
          <h1 class="m-0 project-title"></h1>
        </div>
        <div class="col-sm-6">
          <ol class="breadcrumb float-sm-right">
            <li class="breadcrumb-item"><a href="#">Home</a></li>
            <li class="breadcrumb-item active">Dashboard</li>
          </ol>
        </div>
    </div>
{% endblock %}


{% block content %}
<div class="row">
  <div class="col-md-6">
    <div class="card card-primary">
      <div class="card-header">
        <h3 class="card-title">Upload Master File</h3>
      </div>
      <div class="card-body">
        <form id="upload-master-product-form">
          <div class="form-group">
            <label for="ProductFile">Master File</label>
            <div class="input-group">
              <div class="custom-file">
                <input type="file" class="custom-file-input" id="ProductFile" name="ProductFile" accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" required>
                <label class="custom-file-label" for="ProductFile">Choose file</label>
              </div>
            </div>
          </div>
        </form>   
      </div>
      <div class="card-footer">
        <button type="submit" form="upload-master-product-form" class="btn btn-primary">Upload</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block js %}
<script>
  const swal_btn = Swal.mixin({
    customClass: {
      confirmButton: 'btn btn-primary',
      cancelButton: 'btn btn-danger'
    },
    buttonsStyling: false
  });

  $(document).ready(function (){
    bsCustomFileInput.init();

    // function upload_data
    $("#upload-master-product-form").submit(function (e) {
      e.preventDefault();

      var form = $(this)[0];
      var data = new FormData(form);

      // var data = new FormData(form);
      console.log(data);
      var url = "{% url 'upload_master_file' %}";
      $.ajax({
        url: url,
        data: data,
        type: "POST",
        enctype: "multipart/form-data",
        processData: false,
        contentType: false,
        cache: false,
        headers: {
          "Authorization": "Token " + localStorage.getItem("AuthToken")
        },
        success: function (data) {
          console.log(data);
          if (data.status === true) {
            swal_btn.fire({
              html: data.msg,
              icon: 'success'
            }).then((result) => {
              $("#upload-master-product-form").trigger("reset");
            });

          } else {
            Swal.fire({
              html: data.msg,
              icon: 'error'
            }).then(() => {
              location.reload();
            });
          }
        },
        error: function (error) {
          console.log(error);
          Swal.fire({
            text: "Error in uploading file!!!",
            icon: 'error'
          }).then(() => {
            location.reload();
          });
        }
      });
    });
  
  });


  </script>
{% endblock %}
